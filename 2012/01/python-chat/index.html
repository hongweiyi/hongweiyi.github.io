<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 人生苦短，我用Python · 小e的笔记</title><meta name="description" content="用脚本语言的原因就是因为其语法简单，使用方便，但是好像一直没有把握其中的精华。虽然仔细读过网上转载过N次的Python少打字小技巧，但还是无法很好的运用。
   
今天逛论坛的时候，看到了一个网友发了一个ip地址排序的帖子，代码行数60行，核心代码30多行。没有仔细读，看看评论的时候，看到了另一个解法，总代码6行，核心代码4行。用了列表解析、匿名函数等特性，还有内置函数，代码如下：
1234&lt;span c"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tags" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="http://weibo.com/1674333040" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://twitter.com/hongwei89" target="_blank" class="nav-list-link">TWITTER</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">人生苦短，我用Python</h1><div class="post-meta"><div class="post-time">Jan 20, 2012 | [<a class="tag-link" href="/tags/Python/">Python</a>]</div></div><div class="post-content"><p>用脚本语言的原因就是因为其语法简单，使用方便，但是好像一直没有把握其中的精华。虽然仔细读过网上转载过N次的<a href="http://www.joynb.net/blog/archives/120" target="_blank" rel="external">Python少打字小技巧</a>，但还是无法很好的运用。</p>
 <a id="more"></a>  
<p>今天逛论坛的时候，看到了一个网友发了一个<a href="http://bbs.chinaunix.net/thread-823862-1-1.html" target="_blank" rel="external">ip地址排序</a>的帖子，代码行数60行，核心代码30多行。没有仔细读，看看评论的时候，看到了另一个解法，总代码6行，核心代码4行。用了列表解析、匿名函数等特性，还有内置函数，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iplist=[‘<span class="number">192.168</span><span class="number">.1</span><span class="number">.33</span>′,’<span class="number">10.5</span><span class="number">.1</span><span class="number">.3</span>′,’<span class="number">10.5</span><span class="number">.2</span><span class="number">.4</span>′,’<span class="number">202.98</span><span class="number">.96</span><span class="number">.68</span>′,’<span class="number">13.12</span><span class="number">.1</span><span class="number">.1</span>’]  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip2int</span><span class="params">(s)</span>:</span>  </span><br><span class="line">    l = [int(i) <span class="keyword">for</span> i <span class="keyword">in</span> s.split(‘.’)]  </span><br><span class="line">    <span class="keyword">return</span> (l[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (l[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (l[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> ) | l[<span class="number">3</span>]  </span><br><span class="line">      </span><br><span class="line">iplist.sort(<span class="keyword">lambda</span> x, y: cmp(ip2int(x), ip2int(y)))  </span><br><span class="line"><span class="keyword">print</span> iplist</span><br></pre></td></tr></table></figure>
<p>按照<a href="http://www.joynb.net/blog/archives/120" target="_blank" rel="external">Python少打字小技巧</a>里的例子，这个代码核心部分可以缩减到2行（其实可以只有1行），不过，可读性就不敢恭维咯。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iplist=[‘<span class="number">192.168</span><span class="number">.1</span><span class="number">.33</span>′,’<span class="number">10.5</span><span class="number">.1</span><span class="number">.3</span>′,’<span class="number">10.5</span><span class="number">.2</span><span class="number">.4</span>′,’<span class="number">202.98</span><span class="number">.96</span><span class="number">.68</span>′,’<span class="number">13.12</span><span class="number">.1</span><span class="number">.1</span>’]  </span><br><span class="line">p = <span class="keyword">lambda</span> ip: sum( [ int(k)*v <span class="keyword">for</span> k, v <span class="keyword">in</span> zip(ip.split(‘.’), [<span class="number">1</span>&lt;&lt;<span class="number">24</span>, <span class="number">65536</span>, <span class="number">256</span>, <span class="number">1</span>])]);  </span><br><span class="line">iplist.sort(<span class="keyword">lambda</span> x, y: cmp(p(x), p(y)))  </span><br><span class="line"><span class="keyword">print</span> iplist</span><br></pre></td></tr></table></figure>
<p>既然说到短小精悍，就写写Python的一些特性和函数吧：lambda、map、reduce、filter</p>
<p><strong>lambda</strong></p>
<p>匿名函数，和c/c++中的宏定义类似，格式为：lambda [参数] : [表达式]，如：lambda x : x+2，调用的时候可以用一个变量接收这个函数，并传入参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lam = <span class="keyword">lambda</span> x : x+<span class="number">2</span>  </span><br><span class="line"><span class="keyword">print</span> lam(<span class="number">2</span>)  </span><br><span class="line"><span class="keyword">print</span> (<span class="keyword">lambda</span> x : x+<span class="number">2</span>)(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>有些人觉得lambda也就这点功能，但笔者认为，这才是脚本语言，点题：人生苦短，我用Python！这位<a href="http://www.cnblogs.com/coderzh/archive/2010/04/30/python-cookbook-lambda.html" target="_blank" rel="external"><strong>博主</strong></a>写得不错，可以参考参考。</p>
<p><strong>map，reduce，filter</strong></p>
<p>其实lambda很多地方都是用在上面这三个函数上面，map(func,seq)、reduce(func,seq,initial=None)、filter(bool_func,seq)。</p>
<ul>
<li>map：对seq中的每一个对象都执行func函数，并返回一个列表；</li>
<li>reduce：对seq中的每两个对象依次执行func函数，并返回一个值，如1+2+3+4；</li>
<li>filter：过滤掉seq中不符合bool_func的对象。</li>
</ul>
<p>虽然这三个函数中func都可以使用def来定义，但是如果程序需要的逻辑比较简单的话，用lambda就足够了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ls = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]  </span><br><span class="line"><span class="comment"># every item in ls plus 2  </span></span><br><span class="line"><span class="keyword">print</span> map(<span class="keyword">lambda</span> x : x+<span class="number">2</span>, ls)  </span><br><span class="line"><span class="comment"># sum(ls)  </span></span><br><span class="line"><span class="keyword">print</span> reduce(<span class="keyword">lambda</span> x, y : x+y, ls)  </span><br><span class="line"><span class="comment"># filter the item which less than 2  </span></span><br><span class="line"><span class="keyword">print</span> filter(<span class="keyword">lambda</span> x : x &gt; <span class="number">2</span> <span class="keyword">and</span> <span class="keyword">True</span> <span class="keyword">or</span> <span class="keyword">False</span>, ls)</span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2012/02/iterative-mapred/" class="prev">上一篇</a><a href="/2011/10/dist-filesystem-metadata-server/" class="next">下一篇</a></div><div data-thread-key="2012/01/python-chat/" data-title="人生苦短，我用Python" data-url="http://hongweiyi.com/2012/01/python-chat/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"yihongwei"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-66911097-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>