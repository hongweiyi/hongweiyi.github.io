<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 多列group-by及其应用场景 · 小e的笔记</title><meta name="description" content="1、前言
一直以来都对多列group by没什么感觉，也不知道它到底要干嘛。这篇文章就粗略的讲一下什么是多列groupby，以及它的应用场景简例，没有什么深度，仅作为自己的知识笔记。

BTW: 没感觉应该是因为一直没怎么接触数据库吧，罪过罪过(- -)  

2、group by
group by是SQL的语法，它一般结合一些聚合函数(aggregate functions)一起使用，如：SUM、AVG、MAX等。单列group by，比如group by columnA，就意味着，将A列中，所有相同的值放在同一个group。如下：                               
purchase_date"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="http://weibo.com/1674333040" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://twitter.com/hongwei89" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/tags" target="_self" class="nav-list-link">TAGS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">多列group-by及其应用场景</h1><div class="post-meta"><div class="post-time">May 28, 2013</div></div><div class="post-content"><p><strong>1、前言</strong></p>
<p>一直以来都对多列group by没什么感觉，也不知道它到底要干嘛。这篇文章就粗略的讲一下什么是多列groupby，以及它的应用场景简例，没有什么深度，仅作为自己的知识笔记。</p>
<blockquote>
<p><strong>BTW: </strong>没感觉应该是因为一直没怎么接触数据库吧，罪过罪过(- -)<a id="more"></a>  </p>
</blockquote>
<p><strong>2、group by</strong></p>
<p>group by是SQL的语法，它一般结合一些聚合函数(aggregate functions)一起使用，如：SUM、AVG、MAX等。单列group by，比如group by columnA，就意味着，将A列中，所有相同的值放在同一个group。如下：<br> <center>   <table border="1" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td valign="top" width="119">           </td></tr></tbody></table></center></p>
<p><strong>purchase_date</strong><br>                   <td valign="top" width="131">           </td></p>
<p><strong>item</strong><br>                   <td valign="top" width="95">           </td></p>
<p><strong>items_purchased</strong><br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-03-25<br>                   <td valign="top" width="131">           </td></p>
<p>Wireless Mouse<br>                   <td valign="top" width="95">           </td></p>
<p>2<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-03-25<br>                   <td valign="top" width="131">           </td></p>
<p>Wireless Mouse<br>                   <td valign="top" width="95">           </td></p>
<p>5<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-03-25<br>                   <td valign="top" width="131">           </td></p>
<p>MacBook Pro<br>                   <td valign="top" width="95">           </td></p>
<p>1<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-04-01<br>                   <td valign="top" width="131">           </td></p>
<p>Paper Clips<br>                   <td valign="top" width="95">           </td></p>
<p>20<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-04-01<br>                   <td valign="top" width="131">           </td></p>
<p>Stapler<br>                   <td valign="top" width="95">           </td></p>
<p>3<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-04-01<br>                   <td valign="top" width="131">           </td></p>
<p>Paper Clips<br>                   <td valign="top" width="95">           </td></p>
<p>15<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-05-15<br>                   <td valign="top" width="131">           </td></p>
<p>DVD player<br>                   <td valign="top" width="95">           </td></p>
<p>3<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-05-15<br>                   <td valign="top" width="131">           </td></p>
<p>DVD player<br>                   <td valign="top" width="95">           </td></p>
<p>8<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-05-15<br>                   <td valign="top" width="131">           </td></p>
<p>Stapler<br>                   <td valign="top" width="95">           </td></p>
<p>5<br>                        <tr>         <td valign="top" width="119">           </td></tr></p>
<p>2013-05-16<br>                   <td valign="top" width="131">           </td></p>
<p>MacBook Pro<br>                   <td valign="top" width="95">           </td></p>
<p>2<br>                        </p>
<p>用户需要知道，哪天购买的东西最多，那就可以用group by，SQL如下：</p>
<blockquote>
<p>select purchase_date, count(items_purchased) as purchased_count </p>
<p>from Purchases group by purchase_date order by purchased_count desc; <center>   <table border="1" cellspacing="0" cellpadding="0" width="247"><tbody>       <tr>         <td valign="top" width="129">           </td></tr></tbody></table></center></p>
</blockquote>
<p><strong>purchase_date</strong><br>                   <td valign="top" width="116">           </td></p>
<p><strong>purchased_count</strong><br>                        <tr>         <td valign="top" width="129">           </td></tr></p>
<p>2013-04-01<br>                   <td valign="top" width="116">           </td></p>
<p>38<br>                        <tr>         <td valign="top" width="129">           </td></tr></p>
<p>2013-05-15<br>                   <td valign="top" width="116">           </td></p>
<p>16<br>                        <tr>         <td valign="top" width="129">           </td></tr></p>
<p>2013-03-25<br>                   <td valign="top" width="116">           </td></p>
<p>8<br>                        <tr>         <td valign="top" width="129">           </td></tr></p>
<p>2013-05-16<br>                   <td valign="top" width="116">           </td></p>
<p>2<br>                        </p>
<p><strong>3、多列group by</strong></p>
<p>同上，用户如果想知道，给定日期，该天商品购买的详细情况，这就需要使用多列group by了。</p>
<p>多列group by，比如group by columnA, columnB，就意味着，将A、B两列中均相同的值放在同一个group。SQL可以这样写：</p>
<blockquote>
<pre>select purchase_date, item, sum(items_purchased) as 

&quot;total items&quot; from Purchases group by item, purchase_date;</pre>

</blockquote>
<p>返回结果如下：</p>
<center><br>  <table border="1" cellspacing="0" cellpadding="0" width="347"><tbody><br>      <tr><br>        <td valign="top" width="115"><br><br><strong>purchase_date</strong><br><br>        </td><br><br>        <td valign="top" width="123"><br><br><strong>item</strong><br><br>        </td><br><br>        <td valign="top" width="107"><br><br><strong>Total Items</strong><br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-03-25<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>Wireless Mouse<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>7<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-03-25<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>MacBook Pro<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>1<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-04-01<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>Paper Clips<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>35<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-04-01<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>Stapler<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>3<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-05-15<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>DVD player<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>11<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-05-15<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>Stapler<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>5<br><br>        </td><br>      </tr><br><br>      <tr><br>        <td valign="top" width="115"><br><br>2013-05-16<br><br>        </td><br><br>        <td valign="top" width="123"><br><br>MacBook Pro<br><br>        </td><br><br>        <td valign="top" width="107"><br><br>2<br><br>        </td><br>      </tr><br>    </tbody></table><br></center>

<p>多列group by会将被groupby的多列合成相同的group，并可对每个group进行相应的聚合，如前面的sum()。</p>
<p>&#160;</p>
<blockquote>
<p><strong>参考文献：</strong></p>
<p><strong><a href="http://t.cn/zHJvZ7E" target="_blank" rel="external">ProgrammerInterview.com</a></strong></p>
<p><a href="http://stackoverflow.com/questions/2421388/using-group-by-on-multiple-columns" target="_blank" rel="external">StackOverflow</a> - Using group by on multiple columns</p>
<p><strong>BTW:</strong> 技术还是看英文吧。</p>
</blockquote>
</div></article></div></section><footer><div class="paginator"><a href="/2013/08/solr-switch-query-parser/" class="prev">上一篇</a><a href="/2013/04/apache-solr-data-structrue-part-2/" class="next">下一篇</a></div><div data-thread-key="2013/05/multi-columns-group-by/" data-title="多列group-by及其应用场景" data-url="http://hongweiyi.com/2013/05/multi-columns-group-by/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"yihongwei"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-66911097-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>